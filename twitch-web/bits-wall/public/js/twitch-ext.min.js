!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionEventActions=void 0;var i=n(14);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var s=n(15);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var r=n(16);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}));var o=n(17);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var a=n(18);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var c=n(19);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=n(20);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));t.ExtensionEventActions=[s.SupervisorAction.SupervisorReady,i.ExtensionAction.TwitchExtLoaded,i.ExtensionAction.TwitchExtLongtask,i.ExtensionAction.TwitchExtUserAction,i.ExtensionAction.TwitchExtNetworkTiming,i.ExtensionAction.TwitchExtBeginPurchase,i.ExtensionAction.TwitchExtBitsOnHover,i.ExtensionAction.TwitchExtUseBits,i.ExtensionAction.TwitchExtPubSubReceived,i.ExtensionAction.TwitchExtPubsubListen,i.ExtensionAction.TwitchExtPubsubUnlisten,i.ExtensionAction.TwitchExtCustomTrackEvent,r.FunctionAction.FollowAction,r.FunctionAction.FollowStatusRequest,r.FunctionAction.IdShareRequest,r.FunctionAction.TwitchExtMinimize,r.FunctionAction.UseBits,r.FunctionAction.SubscribeToChannel,r.FunctionAction.ConditionParticipantsRequest,r.FunctionAction.ConditionsRequest,r.FunctionAction.CreateConditionRequest,r.FunctionAction.ConditionConfirmationRequest]},function(e,t,n){(function(i){var s;
/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */!function(r){var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10;function c(){this._events={},this._conf&&u.call(this,this._conf)}function u(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==r?e.maxListeners:a,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=a}function l(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==i&&i.emitWarning){var s=new Error(n);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,i.emitWarning(s)}else console.error(n),console.trace&&console.trace()}function h(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,u.call(this,e)}function d(e,t,n,i){if(!n)return[];var s,r,o,a,c,u,l,h=[],f=t.length,p=t[i],_=t[i+1];if(i===f&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(s=0,r=n._listeners.length;s<r;s++)e&&e.push(n._listeners[s]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&(h=h.concat(d(e,t,n[o],i+1)));return h}if("**"===p){for(o in(l=i+1===f||i+2===f&&"*"===_)&&n._listeners&&(h=h.concat(d(e,t,n,f))),n)"_listeners"!==o&&n.hasOwnProperty(o)&&("*"===o||"**"===o?(n[o]._listeners&&!l&&(h=h.concat(d(e,t,n[o],f))),h=h.concat(d(e,t,n[o],i))):h=o===_?h.concat(d(e,t,n[o],i+2)):h.concat(d(e,t,n[o],i)));return h}h=h.concat(d(e,t,n[p],i+1))}if((a=n["*"])&&d(e,t,a,i+1),c=n["**"])if(i<f)for(o in c._listeners&&d(e,t,c,f),c)"_listeners"!==o&&c.hasOwnProperty(o)&&(o===_?d(e,t,c[o],i+2):o===p?d(e,t,c[o],i+1):((u={})[o]=c[o],d(e,t,{"**":u},i+1)));else c._listeners?d(e,t,c,f):c["*"]&&c["*"]._listeners&&d(e,t,c["*"],f);return h}function f(e,t){for(var n=0,i=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;n+1<i;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var s=this.listenerTree,o=e.shift();o!==r;){if(s[o]||(s[o]={}),s=s[o],0===e.length)return s._listeners?("function"==typeof s._listeners&&(s._listeners=[s._listeners]),s._listeners.push(t),!s._listeners.warned&&this._maxListeners>0&&s._listeners.length>this._maxListeners&&(s._listeners.warned=!0,l.call(this,s._listeners.length,o))):s._listeners=t,!0;o=e.shift()}return!0}h.EventEmitter2=h,h.prototype.delimiter=".",h.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},h.prototype.event="",h.prototype.once=function(e,t){return this._once(e,t,!1)},h.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},h.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},h.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},h.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},h.prototype._many=function(e,t,n,i){var s=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function r(){return 0==--t&&s.off(e,r),n.apply(this,arguments)}return r._origin=n,this._on(e,r,i),s},h.prototype.emit=function(){this._events||c.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,n,i,s,r,o=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),o>3)for(t=new Array(o),s=0;s<o;s++)t[s]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this,e);break;case 2:r[i].call(this,e,arguments[1]);break;case 3:r[i].call(this,e,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}}if(this.wildcard){r=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();d.call(this,r,a,this.listenerTree,0)}else{if("function"==typeof(r=this._events[e])){switch(this.event=e,o){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];r.apply(this,t)}return!0}r&&(r=r.slice())}if(r&&r.length){if(o>3)for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this);break;case 2:r[i].call(this,arguments[1]);break;case 3:r[i].call(this,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},h.prototype.emitAsync=function(){this._events||c.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,i,s,r,o=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),s=1;s<a;s++)t[s]=arguments[s];for(i=0,n=this._all.length;i<n;i++)switch(this.event=e,a){case 1:o.push(this._all[i].call(this,e));break;case 2:o.push(this._all[i].call(this,e,arguments[1]));break;case 3:o.push(this._all[i].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[i].apply(this,t))}}if(this.wildcard){r=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();d.call(this,r,u,this.listenerTree,0)}else r=this._events[e];if("function"==typeof r)switch(this.event=e,a){case 1:o.push(r.call(this));break;case 2:o.push(r.call(this,arguments[1]));break;case 3:o.push(r.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),s=1;s<a;s++)t[s-1]=arguments[s];o.push(r.apply(this,t))}else if(r&&r.length){if(r=r.slice(),a>3)for(t=new Array(a-1),s=1;s<a;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,a){case 1:o.push(r[i].call(this));break;case 2:o.push(r[i].call(this,arguments[1]));break;case 3:o.push(r[i].call(this,arguments[1],arguments[2]));break;default:o.push(r[i].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},h.prototype.on=function(e,t){return this._on(e,t,!1)},h.prototype.prependListener=function(e,t){return this._on(e,t,!0)},h.prototype.onAny=function(e){return this._onAny(e,!1)},h.prototype.prependAny=function(e){return this._onAny(e,!0)},h.prototype.addListener=h.prototype.on,h.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},h.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||c.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(f.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,l.call(this,this._events[e].length,e))):this._events[e]=t,this)},h.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();i=d.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var a=0;a<i.length;a++){var c=i[a];if(n=c._listeners,o(n)){for(var u=-1,l=0,h=n.length;l<h;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){u=l;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(t!==r){var n=Object.keys(t);for(var i in n){var s=n[i],o=t[s];o instanceof Function||"object"!=typeof o||null===o||(Object.keys(o).length>0&&e(t[s]),0===Object.keys(o).length&&delete t[s])}}}(this.listenerTree),this},h.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},h.prototype.removeListener=h.prototype.off,h.prototype.removeAllListeners=function(e){if(e===r)return!this._events||c.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=d.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){n[i]._listeners=null}else this._events&&(this._events[e]=null);return this},h.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return d.call(this,t,n,this.listenerTree,0),t}return this._events||c.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},h.prototype.eventNames=function(){return Object.keys(this._events)},h.prototype.listenerCount=function(e){return this.listeners(e).length},h.prototype.listenersAny=function(){return this._all?this._all:[]},(s=function(){return h}.call(t,n,t,e))===r||(e.exports=s)}()}).call(this,n(7))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),o=(i=r)&&i.__esModule?i:{default:i};var a=function(){},c=a,u={},l={DEBUG:1,INFO:2,WARNING:3,ERROR:4,CRITICAL:5},h=l.WARNING,d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._opts=t}return s(e,[{key:"debug",value:function(e){h<=l.DEBUG&&this._log("DEBUG: "+e)}},{key:"info",value:function(e){h<=l.INFO&&this._log("INFO: "+e)}},{key:"warning",value:function(e){h<=l.WARNING&&this._log("WARNING: "+e)}},{key:"error",value:function(e){h<=l.ERROR&&this._log("ERROR: "+e)}},{key:"critical",value:function(e){h<=l.CRITICAL&&this._log("CRITICAL: "+e)}},{key:"_log",value:function(e){var t=this._opts.prefix+e;this._opts.logFunc?this._opts.logFunc(t):c(t)}}]),e}(),f={setLogger:function(e){c="function"==typeof e?e:a},setLevel:function(){var e=(o.default.urlParams.pubsub_log_level||"").toUpperCase();if(e){var t=l[e];if(t)return h=t,function(){}}return function(e){h=e&&l[e.toUpperCase()]||l.WARNING}}(),_getLogger:function(e){return u[e]||(u[e]=new d({prefix:"pubsub.js ["+e+"] "})),u[e]},_noopLogger:new d({prefix:"",logFunc:a})},p=window.console;p&&p.log&&(p.log.apply?f.setLogger((function(){p.log.apply(p,arguments)})):f.setLogger((function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);p.log(e.join(" "))}))),t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={randomInt:function(e){return Math.floor(Math.random()*e)}};i.time={seconds:function(e){return 1e3*e},now:function(){return(new Date).getTime()}},i.urlParams=function(){for(var e={},t=window.location.search.substr(1).split("&"),n=0;n<t.length;++n){var i=t[n].split("=");e[decodeURIComponent(i[0])]=i.length>1?decodeURIComponent(i[1]):""}return e}(),i.generateString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;s<e;s++)t+=n.charAt(i.randomInt(n.length));return t},i.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"on",value:function(e,t,n){return this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t,n),this}},{key:"off",value:function(e,t){if(this._events)for(var n=this._events[e]||[],i=this._events[e]=[],s=0;s<n.length;s+=2)n[s]!==t&&(i.push(n[s]),i.push(n[s+1]));return this}},{key:"_trigger",value:function(e){if(this._events)for(var t=this._events[e]||[],n=1;n<t.length;n+=2)t[n-1].apply(t[n],Array.prototype.slice.call(arguments,1));return this}},{key:"count",value:function(e){return this._events?(this._events[e]||[]).length/2:0}}]),e}();t.default=s},function(e,t,n){(function(t){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.5+7f2b526d
 */var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,s=void 0,r=void 0,o=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(r?r(p):y())},a="undefined"!=typeof window?window:void 0,c=a||{},u=c.MutationObserver||c.WebKitMutationObserver,l="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(p,1)}}var f=new Array(1e3);function p(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var _,g,v,b,y=void 0;function m(e,t){var n=this,i=new this.constructor(k);void 0===i[E]&&F(i);var s=n._state;if(s){var r=arguments[s-1];o((function(){return U(s,i,r,n._result)}))}else I(n,i,e,t);return i}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(k);return O(t,e),t}l?y=function(){return t.nextTick(p)}:u?(g=0,v=new u(p),b=document.createTextNode(""),v.observe(b,{characterData:!0}),y=function(){b.data=g=++g%2}):h?((_=new MessageChannel).port1.onmessage=p,y=function(){return _.port2.postMessage(0)}):y=void 0===a?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(p)}:d()}catch(e){return d()}}():d();var E=Math.random().toString(36).substring(2);function k(){}var T=void 0,x=1,S=2,P={error:null};function C(e){try{return e.then}catch(e){return P.error=e,P}}function A(t,n,i){n.constructor===t.constructor&&i===m&&n.constructor.resolve===w?function(e,t){t._state===x?R(e,t._result):t._state===S?M(e,t._result):I(t,void 0,(function(t){return O(e,t)}),(function(t){return M(e,t)}))}(t,n):i===P?(M(t,P.error),P.error=null):void 0===i?R(t,n):e(i)?function(e,t,n){o((function(e){var i=!1,s=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,(function(n){i||(i=!0,t!==n?O(e,n):R(e,n))}),(function(t){i||(i=!0,M(e,t))}),e._label);!i&&s&&(i=!0,M(e,s))}),e)}(t,n,i):R(t,n)}function O(e,t){var n,i;e===t?M(e,new TypeError("You cannot resolve a promise with itself")):(i=typeof(n=t),null===n||"object"!==i&&"function"!==i?R(e,t):A(e,t,C(t)))}function L(e){e._onerror&&e._onerror(e._result),j(e)}function R(e,t){e._state===T&&(e._result=t,e._state=x,0!==e._subscribers.length&&o(j,e))}function M(e,t){e._state===T&&(e._state=S,e._result=t,o(L,e))}function I(e,t,n,i){var s=e._subscribers,r=s.length;e._onerror=null,s[r]=t,s[r+x]=n,s[r+S]=i,0===r&&e._state&&o(j,e)}function j(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,s=void 0,r=e._result,o=0;o<t.length;o+=3)i=t[o],s=t[o+n],i?U(n,i,s,r):s(r);e._subscribers.length=0}}function U(t,n,i,s){var r=e(i),o=void 0,a=void 0,c=void 0,u=void 0;if(r){if((o=function(e,t){try{return e(t)}catch(e){return P.error=e,P}}(i,s))===P?(u=!0,a=o.error,o.error=null):c=!0,n===o)return void M(n,new TypeError("A promises callback cannot return that same promise."))}else o=s,c=!0;n._state!==T||(r&&c?O(n,o):u?M(n,a):t===x?R(n,o):t===S&&M(n,o))}var q=0;function F(e){e[E]=q++,e._state=void 0,e._result=void 0,e._subscribers=[]}var N=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(k),this.promise[E]||F(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):M(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===T&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===w){var s=C(e);if(s===m&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(n===B){var r=new n(k);A(r,e,s),this._willSettleAt(r,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===T&&(this._remaining--,e===S?M(i,n):this._result[t]=n),0===this._remaining&&R(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;I(e,void 0,(function(e){return n._settledAt(x,t,e)}),(function(e){return n._settledAt(S,t,e)}))},e}(),B=function(){function t(e){this[E]=q++,this._result=this._state=void 0,this._subscribers=[],k!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){O(e,t)}),(function(t){M(e,t)}))}catch(t){M(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return B.prototype.then=m,B.all=function(e){return new N(this,e).promise},B.race=function(e){var t=this;return n(e)?new t((function(n,i){for(var s=e.length,r=0;r<s;r++)t.resolve(e[r]).then(n,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},B.resolve=w,B.reject=function(e){var t=new this(k);return M(t,e),t},B._setScheduler=function(e){r=e},B._setAsap=function(e){o=e},B._asap=o,B.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=B},B.Promise=B,B},e.exports=n()}).call(this,n(7))},function(e,t,n){var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/assets/",n(n.s=1)}([,function(e,t,n){"use strict";function i(e){return!!(e&&e.timing&&e.getEntriesByType&&e.setResourceTimingBufferSize&&e.clearResourceTimings)}Object.defineProperty(t,"__esModule",{value:!0}),t.isSniffingAllowed=i,n.d(t,"NetworkSniffer",(function(){return s}));var s=function(){function e(e,t){this.performance=e,this.frameURL=t,this.resourceEntriesIndex=0,this.resourceListeners=[],this.startCalled=!1,console.assert(i(e),"performance object does not support sniffing")}return e.prototype.start=function(){return!this.startCalled&&(this.startCalled=!0,this.setResourceBufferSize(),setInterval(this.processNewResourceTimings.bind(this),1e3),!0)},e.prototype.getFrameTiming=function(){return this.performance.timing},e.prototype.getAvailableResourceTimings=function(){return this.performance.getEntriesByType("resource")},e.prototype.addResourceListener=function(e){this.resourceListeners.push(e)},e.prototype.removeResourceListener=function(e){this.resourceListeners=this.resourceListeners.filter((function(t){return t!==e}))},e.prototype.setResourceBufferSize=function(){this.performance.setResourceTimingBufferSize(1e3)},e.prototype.clearResourceBuffer=function(){this.resourceEntriesIndex=0,this.performance.clearResourceTimings(),this.setResourceBufferSize()},e.prototype.isResourceBufferAlmostFull=function(){return this.performance.getEntriesByType("resource").length>=750},e.prototype.processNewResourceTimings=function(){var e=this;this.performance.getEntriesByType("resource").slice(this.resourceEntriesIndex).forEach((function(t){e.resourceEntriesIndex++,e.fireResourceListeners(t)})),this.isResourceBufferAlmostFull()&&this.clearResourceBuffer()},e.prototype.fireResourceListeners=function(e){this.resourceListeners.forEach((function(t){t(e)}))},e}()}])},e.exports=i()},function(e,t){var n,i,s=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var e=a(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function _(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=_,s.addListener=_,s.once=_,s.off=_,s.removeListener=_,s.removeAllListeners=_,s.emit=_,s.prependListener=_,s.prependOnceListener=_,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var s=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,s=n;return[s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map={},this._size=0}return i(e,[{key:"set",value:function(e,t){this._map.hasOwnProperty(e)||(this._size+=1),this._map[e]=t}},{key:"get",value:function(e){return this._map[e]}},{key:"has",value:function(e){return this._map.hasOwnProperty(e)}},{key:"remove",value:function(e){this._map.hasOwnProperty(e)&&(this._size-=1),delete this._map[e]}},{key:"size",value:function(){return this._size}},{key:"map",value:function(){return this._map}},{key:"values",value:function(){var e=[];for(var t in this._map)this._map.hasOwnProperty(t)&&e.push(this._map[t]);return e}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionCoordinator=t.Initiator=void 0;var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(21)),s=n(22),r=n(0),o=n(23),a=n(24);var c=t.Initiator=void 0;!function(e){e.CurrentUser="current_user",e.Other="other"}(c||(t.Initiator=c={}));var u=function(e){function t(t){var n=e.call(this)||this;return n.iframe=t,n.destroy=function(){n.iframe.ownerDocument.defaultView.removeEventListener("message",n.handleMessage)},n.sendContext=function(e,t){n.sendMessage({action:r.ExtensionAction.TwitchExtContext,context:e,updatedFields:t})},n.sendExtensionAuth=function(e){n.sendMessage({action:r.ExtensionAction.TwitchExtAuth,auth:e})},n.sendExtensionBootstrap=function(e,t,i,s){n.sendMessage({action:r.ExtensionAction.TwitchExtBootstrap,auth:e,features:t,configuration:i,viewerInfo:s})},n.sendSupervisorInit=function(e){n.sendMessage({action:r.SupervisorAction.SupervisorInit,options:e})},n.sendFunctionReply=function(e){n.sendMessage(e)},n.sendExtensionReloadEntitlementsMessage=function(){n.sendMessage({action:r.ExtensionAction.TwitchExtReloadEntitlements})},n.sendVisibilityChanged=function(e,t){n.sendMessage({action:r.ExtensionAction.TwitchExtVisibilityChanged,isVisible:e,context:t})},n.sendPositionChange=function(e){n.sendMessage({action:r.ExtensionAction.TwitchExtPositionChanged,position:e})},n.sendHighlightChange=function(e){n.sendMessage({action:r.ExtensionAction.TwitchExtHighlightChanged,isHighlighted:e})},n.sendBitsProductsMessage=function(e){n.sendMessage({action:r.ExtensionAction.TwitchExtBitsProducts,products:e})},n.sendBitsTransactionCompleteMessage=function(e){n.sendMessage(e)},n.sendHelperPubsubMessage=function(e,t,i){n.sendMessage({action:r.ExtensionAction.TwitchExtPubsubMessage,payload:{target:e,contentType:t,content:i}})},n.sendHelperPubsubBindFailure=function(e,t){n.sendMessage({action:r.ExtensionAction.TwitchExtPubsubBindFailure,payload:{target:e,error:t}})},n.sendViewerUpdateMessage=function(e){n.sendMessage({action:r.ExtensionAction.TwitchExtViewerUpdate,viewerInfo:e})},n.sendConditionParticipantsResponseMessage=function(e,t,i){n.sendMessage({action:r.FunctionAction.ConditionParticipantsResponse,payload:{response:e,error:i,callbackGuid:t}})},n.sendConditionsResponseMessage=function(e,t,i){n.sendMessage({action:r.FunctionAction.ConditionsResponse,payload:{response:e,error:i,callbackGuid:t}})},n.sendCreateConditionResponseMessage=function(e,t,i){n.sendMessage({action:r.FunctionAction.CreateConditionResponse,payload:{response:e,error:i,callbackGuid:t}})},n.handleMessage=function(e){var t=e.source,i=e.data;if(t===n.iframe.contentWindow)try{n.handleExtensionAction(i)}catch(e){}},n.handleExtensionAction=function(e){-1!==r.ExtensionEventActions.indexOf(e.action)&&n.emit(e.action,e)},n.sendMessage=function(e){n.iframe&&n.iframe.contentWindow&&n.iframe.contentWindow.postMessage(e,o.supervisor.supervisorOrigin)},n.iframe.ownerDocument.defaultView.addEventListener("message",n.handleMessage),n}return i.__extends(t,e),t.prototype.sendExtensionReloadMessage=function(){this.sendMessage({action:r.ExtensionAction.TwitchExtReload})},t.prototype.sendExtensionProductPricesMessage=function(e){var t=e.products.reduce((function(e,t){var n=t.sku,i=t.price;return e[n]={displayPrice:(0,a.formatPrice)(i.price,i.currency_unit)},e}),{});this.sendMessage({action:r.ExtensionAction.TwitchExtProductPrices,prices:t})},t}(s.EventEmitter);t.ExtensionCoordinator=u},function(e,t,n){var i=n(25),s=n(26),r=s;r.v1=i,r.v4=s,e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=d(n(4)),r=d(n(2)),o=d(n(3)),a=d(n(27)),c=d(n(28)),u=d(n(29)),l=n(33),h=d(n(31));function d(e){return e&&e.__esModule?e:{default:e}}var f=r.default._getLogger("PubsubDriver"),p=3e4,_=/^https?:\/\/([\w-]+\.)*twitch\.(tv|tech)(:\d+)?\/.*$/,g=1,v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._env=o.default.urlParams.pubsub_environment||e,n._clientReady=!1,n._hasDisconnected=!1,n._queuedRequests=[],n._stats=l.Stats.getInstance(n._env,"pubsub-js-client"),n._numDisconnects=0,o.default.inIframe()&&_.test(document.referrer)?(f.debug("Driver is in an iframe"),n._client=new a.default({parentUrl:document.referrer}),n._clientType="iframe-verified"):(f.debug("Driver is not in an iframe"),n._client=new u.default({env:n._env,stats:n._stats}),n._iframeHost=new c.default(n._client),n._clientType="ws"),n._stats.setPrefix("pubsub-js-client."+n._clientType),"true"===o.default.urlParams.force_pubsub_tester?g=1:"false"===o.default.urlParams.force_pubsub_tester&&(g=0),Math.random()<g&&window.setTimeout(n.runTest.bind(n),p),n._client.on("unverified",n._clientUnverified,n),n._client.on("verified",n._clientVerified,n),n._client.verify(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"runTest",value:function(){this._tester=new h.default({env:this._env,driver:this,stats:this._stats})}},{key:"connect",value:function(){}},{key:"Listen",value:function(e){this._clientReady?this._client.Listen(e):this._queuedRequests.push({type:"LISTEN",opts:e})}},{key:"Unlisten",value:function(e){this._clientReady?this._client.Unlisten(e):this._queuedRequests.push({type:"UNLISTEN",opts:e})}},{key:"_flushQueuedRequests",value:function(){for(f.debug("Flushing "+this._queuedRequests.length+" queued requests");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();switch(e.type){case"LISTEN":this._client.Listen(e.opts);break;case"UNLISTEN":this._client.Unlisten(e.opts)}}}},{key:"_clientConnected",value:function(){f.debug("Client connected"),this._client.on("disconnected",this._clientDisconnected,this),this._stats.logCounter("connected",1),this._trigger("connected"),this._hasDisconnected&&this._trigger("reconnected"),this._clientReady=!0,this._flushQueuedRequests()}},{key:"_clientDisconnected",value:function(){f.debug("Client disconnected"),this._trigger("disconnected"),this._clientReady=!1,this._numDisconnects+=1,this._hasDisconnected=!0}},{key:"_clientVerified",value:function(){f.debug("Client verified (type = "+this._clientType+")"),this._stats.setPrefix("pubsub-js-client."+this._clientType),this._client.on("connected",this._clientConnected,this),this._client.connect(),window.setInterval(this._sendClientTypeGauge.bind(this),6e4)}},{key:"_clientUnverified",value:function(){f.debug("Unverified IframeClient"),this._client.off("verified",this._clientVerified,this),this._client.off("unverified",this._clientUnverified,this),this._client=new u.default({env:this._env,stats:this._stats}),this._clientType="iframe-unverified",this._client.on("unverified",this._clientUnverified,this),this._client.on("verified",this._clientVerified,this),this._client.verify()}},{key:"_sendClientTypeGauge",value:function(){this._stats.logGauge("pubsub-js-client."+this._clientType)}}]),t}(s.default);window.__Twitch__pubsubInstances=window.__Twitch__pubsubInstances||{production:null,staging:null,darklaunch:null},t.default={getInstance:function(e){if("production"!==e&&"staging"!==e&&"darklaunch"!==e)throw"Invalid Pubsub instance environment";return null===window.__Twitch__pubsubInstances[e]&&(window.__Twitch__pubsubInstances[e]=new v(e)),window.__Twitch__pubsubInstances[e]}}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var s=t.ExtensionActivationStatus=void 0;!function(e){e.Active="active",e.Inactive="inactive"}(s||(t.ExtensionActivationStatus=s={}));var r=t.ExtensionAnchor=void 0;!function(e){e.Hidden="hidden",e.Panel="panel",e.Overlay="video_overlay",e.Component="component"}(r||(t.ExtensionAnchor=r={}));var o=t.ExtensionMode=void 0;!function(e){e.Config="config",e.Dashboard="dashboard",e.Viewer="viewer"}(o||(t.ExtensionMode=o={}));var a=t.ExtensionPlatform=void 0;!function(e){e.Mobile="mobile",e.Web="web"}(a||(t.ExtensionPlatform=a={}));var c=t.ExtensionState=void 0;!function(e){e.Testing="Testing",e.HostedTest="Assets Uploaded",e.Approved="Approved",e.Released="Released",e.ReadyForReview="Ready For Review",e.InReview="In Review",e.PendingAction="Pending Action",e.Uploading="Uploading"}(c||(t.ExtensionState=c={}));var u=t.ExternalExtensionState=void 0;!function(e){e.Testing="testing",e.HostedTest="hosted_test",e.Approved="approved",e.Released="released",e.ReadyForReview="ready_for_review",e.InReview="in_review",e.PendingAction="pending_action",e.Uploading="uploading"}(u||(t.ExternalExtensionState=u={}));t.ExtensionStateMap=((i={})[c.Testing]=u.Testing,i[c.HostedTest]=u.HostedTest,i[c.Approved]=u.Approved,i[c.Released]=u.Released,i[c.ReadyForReview]=u.ReadyForReview,i[c.InReview]=u.InReview,i[c.PendingAction]=u.PendingAction,i[c.Uploading]=u.Uploading,i);var l=t.ExtensionAction=void 0;!function(e){e.TwitchExtAuth="twitch-ext-auth",e.TwitchExtBootstrap="twitch-ext-bootstrap",e.TwitchExtContext="twitch-ext-context",e.TwitchExtError="twitch-ext-error",e.TwitchExtLoaded="twitch-ext-loaded",e.TwitchExtLongtask="twitch-ext-longtask",e.TwitchExtNetworkTiming="twitch-ext-network-timing",e.TwitchExtReload="twitch-ext-reload",e.TwitchExtUserAction="twitch-ext-user-action",e.TwitchExtConfirmationRequest="twitch-ext-confirmation-request",e.TwitchExtBeginPurchase="twitch-ext-begin-purchase",e.TwitchExtReloadEntitlements="twitch-ext-reload-entitlements",e.TwitchExtProductPrices="twitch-ext-product-prices",e.TwitchExtVisibilityChanged="twitch-ext-visibility-changed",e.TwitchExtHighlightChanged="twitch-ext-highlight-changed",e.TwitchExtBitsProducts="twitch-ext-bits-products",e.TwitchExtUseBits="twitch-ext-use-bits",e.TwitchExtBitsTransactionComplete="twitch-ext-bits-transaction-complete",e.TwitchExtBitsOnHover="twitch-ext-bits-on-hover",e.TwitchExtPubSubReceived="twitch-ext-pubsub-received",e.TwitchExtPositionChanged="twitch-ext-position-changed",e.TwitchExtPubsubMessage="twitch-ext-pubsub-message",e.TwitchExtPubsubBindFailure="twitch-ext-pubsub-bind-failure",e.TwitchExtPubsubListen="twitch-ext-pubsub-listen",e.TwitchExtPubsubUnlisten="twitch-ext-pubsub-unlisten",e.TwitchExtViewerUpdate="twitch-ext-viewer-update",e.TwitchExtCustomTrackEvent="twitch-ext-custom-track-event"}(l||(t.ExtensionAction=l={}));t.DefaultZoomPixelWidth=1024},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.SupervisorAction=void 0;!function(e){e.SupervisorReady="supervisor-ready",e.SupervisorInit="supervisor-init"}(i||(t.SupervisorAction=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.FunctionAction=void 0;!function(e){e.LoginRequest="twitch-ext-login-request",e.FollowAction="twitch-ext-follow-action",e.FollowComplete="twitch-ext-follow-complete",e.FollowStatusRequest="twitch-ext-follow-status",e.FollowStatusResponse="twitch-ext-follow-status-response",e.IdShareRequest="twitch-ext-id-share-request",e.TwitchExtMinimize="twitch-ext-minimize",e.UseBitsPromptRequired="twitch-ext-use-bits",e.SubscribeToChannel="twitch-ext-subscribe-to-channel",e.SubscribeToChannelResult="twitch-ext-subscribe-to-channel-result",e.UseBits="twitch-ext-use-bits",e.UseBitsComplete="twitch-ext-use-bits-complete",e.ConditionParticipantsRequest="twitch-ext-condition-participants-request",e.ConditionParticipantsResponse="twitch-ext-condition-participants-response",e.ConditionsRequest="twitch-ext-conditions-request",e.ConditionsResponse="twitch-ext-conditions-response",e.CreateConditionRequest="twitch-ext-create-condition-request",e.CreateConditionResponse="twitch-ext-create-condition-response",e.ConditionConfirmationRequest="twitch-ext-condition-confirmation-request",e.ConditionConfirmationResponse="twitch-ext-condition-confirmation-response"}(i||(t.FunctionAction=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DEFAULT_PANEL_HEIGHT=300;var i=t.ExtensionFrameEvents=void 0;!function(e){e.ExtensionFrameLoaded="extensionFrameLoaded",e.IdentityLinked="identityLinked",e.Minimize="minimize",e.RequestModal="requestModal",e.ShowBitsBalance="showBitsBalance",e.ShowUseBitsSuccess="showUseBitsSuccess",e.UseBitsError="useBitsError"}(i||(t.ExtensionFrameEvents=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.PlaybackMode=void 0;!function(e){e.Video="video",e.Audio="audio",e.Remote="remote",e.ChatOnly="chat-only"}(i||(t.PlaybackMode=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.ExtensionServiceEvents=void 0;!function(e){e.RequestModal="requestModal",e.ContextUpdate="contextupdate"}(i||(t.ExtensionServiceEvents=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.BitsModalDataScience=void 0;!function(e){e.UseBitsLinkUserFailure="extension_use_bits_link_user_fail",e.UseBitsUserIneligible="extension_use_bits_user_ineligible",e.UseBitsFailure="extension_use_bits_fail",e.UseBitsInitialization="extension_use_bits_init",e.UseBitsConfirmation="extension_use_bits_confirm",e.UseBitsSuccess="extension_use_bits_success"}(i||(t.BitsModalDataScience=i={}));var s=t.CustomEventInteractionType=void 0;!function(e){e.Click="click",e.Hover="hover",e.Tap="tap",e.Swipe="swipe",e.Impression="impression",e.Other="other"}(s||(t.CustomEventInteractionType=s={}));var r=t.CustomEventCategory=void 0;!function(e){e.Access="access",e.Content="content",e.Reward="reward",e.Bits="bits",e.Interact="interact",e.Account="account",e.Configuration="configuration",e.StreamManager="stream-mgr",e.Error="error",e.Other="other"}(r||(t.CustomEventCategory=r={}));t.ALL_EVENT_INTERACTION_TYPES=Object.keys(s).map((function(e){return s[e]})),t.ALL_EVENT_CATEGORIES=Object.keys(r).map((function(e){return r[e]})),t.MAX_UNIQUE_DEV_EVENT_NAMES=1e3,t.MAX_DEV_EVENT_FIELD_LENGTH=32,t.MAX_CUSTOM_METADATA_LENGTH=100},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return s})),n.d(t,"__assign",(function(){return r})),n.d(t,"__rest",(function(){return o})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return l})),n.d(t,"__generator",(function(){return h})),n.d(t,"__exportStar",(function(){return d})),n.d(t,"__values",(function(){return f})),n.d(t,"__read",(function(){return p})),n.d(t,"__spread",(function(){return _})),n.d(t,"__await",(function(){return g})),n.d(t,"__asyncGenerator",(function(){return v})),n.d(t,"__asyncDelegator",(function(){return b})),n.d(t,"__asyncValues",(function(){return y})),n.d(t,"__makeTemplateObject",(function(){return m})),n.d(t,"__importStar",(function(){return w})),n.d(t,"__importDefault",(function(){return E}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&(n[i[s]]=e[i[s]])}return n}function a(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}function c(e,t){return function(n,i){t(n,i,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function h(e,t){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function d(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function f(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,r=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function _(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function g(e){return this instanceof g?(this.v=e,this):new g(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,s=n.apply(e,t||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise((function(n,i){r.push([e,t,n,i])>1||a(e,t)}))})}function a(e,t){try{(n=s[e](t)).value instanceof g?Promise.resolve(n.value.v).then(c,u):l(r[0][2],n)}catch(e){l(r[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function b(e){var t,n;return t={},i("next"),i("throw",(function(e){throw e})),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,s){t[i]=e[i]?function(t){return(n=!n)?{value:g(e[i](t)),done:"return"===i}:s?s(t):t}:s}}function y(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,s){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,s,(t=e[n](t)).done,t.value)}))}}}function m(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,i,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||e,r),c=s?s+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,o=new Array(r);i<r;i++)o[i]=n[i].fn;return o},u.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,i,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,r),!0;case 6:return l.fn.call(l.context,t,n,i,r,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,i){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return c(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||c(this,r);else{for(var a=0,u=[],l=o.length;a<l;a++)(o[a].fn!==t||i&&!o[a].once||n&&o[a].context!==n)&&u.push(o[a]);u.length?this._events[r]=1===u.length?u[0]:u:c(this,r)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&c(this,t)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=s,u.EventEmitter=u,e.exports=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.SUPERVISOR_LOCATION={production:"https://supervisor.ext-twitch.tv",staging:"https://supervisor.ext-assets.internal.justin.tv"},this.env="production"}return Object.defineProperty(e.prototype,"environment",{get:function(){return this.env},set:function(e){this.env=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supervisorOrigin",{get:function(){return this.SUPERVISOR_LOCATION[this.env]||this.SUPERVISOR_LOCATION.production},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supervisorURL",{get:function(){return this.supervisorOrigin+"/supervisor/v1/index.html"},enumerable:!0,configurable:!0}),e}();t.Supervisor=i;t.supervisor=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatPrice=function(e,t){return"USD"===t?"$"+e:e+" "+t}},function(e,t,n){var i,s,r=n(8),o=n(9),a=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,l=t||[],h=(e=e||{}).node||i,d=void 0!==e.clockseq?e.clockseq:s;if(null==h||null==d){var f=r();null==h&&(h=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=s=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),_=void 0!==e.nsecs?e.nsecs:c+1,g=p-a+(_-c)/1e4;if(g<0&&void 0===e.clockseq&&(d=d+1&16383),(g<0||p>a)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,c=_,s=d;var v=(1e4*(268435455&(p+=122192928e5))+_)%4294967296;l[u++]=v>>>24&255,l[u++]=v>>>16&255,l[u++]=v>>>8&255,l[u++]=255&v;var b=p/4294967296*1e4&268435455;l[u++]=b>>>8&255,l[u++]=255&b,l[u++]=b>>>24&15|16,l[u++]=b>>>16&255,l[u++]=d>>>8|128,l[u++]=255&d;for(var y=0;y<6;++y)l[u+y]=h[y];return t||o(l)}},function(e,t,n){var i=n(8),s=n(9);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[r+a]=o[a];return t||s(o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=c(n(4)),r=c(n(2)),o=c(n(3)),a=c(n(10));function c(e){return e&&e.__esModule?e:{default:e}}var u=r.default._getLogger("IframeClient"),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._parentUrl=e.parentUrl,n._pendingResponses=new a.default,n._listens=new s.default,window.addEventListener("message",n.receiveMessage.bind(n),!1),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"connect",value:function(){window.parent.postMessage({twitch_protocol:"pubsub",type:"connect"},this._parentUrl)}},{key:"verify",value:function(){window.parent.postMessage({twitch_protocol:"pubsub",type:"verify"},this._parentUrl),this._verifyTimeout=setTimeout(this._unverified.bind(this),1e3)}},{key:"Listen",value:function(e){u.debug("listening on "+e.topic);var t=this._generateNonce(),n={twitch_protocol:"pubsub",type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._send(t,n,e)}},{key:"Unlisten",value:function(e){if(u.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1)return e.message&&this._listens.off(e.topic,e.message),e.success&&e.success(),void u.debug("now have "+this._listens.count(e.topic)+" listeners");var t=this._generateNonce(),n={twitch_protocol:"pubsub",type:"UNLISTEN",nonce:t,data:{topics:[e.topic]}};this._send(t,n,e)}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),3e4,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),window.parent.postMessage(t,this._parentUrl)}},{key:"receiveMessage",value:function(e){if(e.data&&"pubsub"==e.data.twitch_protocol)switch(u.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"connected":this._trigger("connected");break;case"disconnected":this._trigger("disconnected");break;case"success":this.handleResponse(!0,e.data);break;case"failure":this.handleResponse(!1,e.data);break;case"message":this.handleMessage(e.data.topic,e.data.message);break;case"verify":this._verified()}}},{key:"handleResponse",value:function(e,t){if(this._pendingResponses.has(t.nonce)){var n=this._pendingResponses.get(t.nonce);u.debug("ResponseInfo: "+JSON.stringify(n)),clearTimeout(n.timeout),this._pendingResponses.remove(t.nonce),e?(n.callbacks.message&&("LISTEN"===n.message.type?this._listens.on(n.topic,n.callbacks.message,this):"UNLISTEN"===n.message.type&&this._listens.off(n.topic,n.callbacks.message,this)),n.callbacks.success&&n.callbacks.success()):n.callbacks.failure&&n.callbacks.failure(t.error)}}},{key:"handleMessage",value:function(e,t){u.debug("received '"+t+"' on topic "+e),this._listens._trigger(e,t)}},{key:"_onResponseTimeout",value:function(e){u.debug("response timed out: "+e)}},{key:"_verified",value:function(){u.debug("Verified"),clearTimeout(this._verifyTimeout),this._trigger("verified")}},{key:"_unverified",value:function(){window.removeEventListener("message",this.receiveMessage.bind(this),!1),this._trigger("unverified")}},{key:"_generateNonce",value:function(){return o.default.generateString(30)}}]),t}(s.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(2),o=(i=r)&&i.__esModule?i:{default:i};var a=1e4,c=o.default._getLogger("IframeHost"),u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._driver=t,this._sources=[],this._listeners=[],this._driver.on("connected",this.handleConnected,this),this._driver.on("disconnected",this.handleDisconnected,this),window.addEventListener("message",this.receiveMessage.bind(this),!1),this._orphanedListenerCheckTimer=setInterval(this._checkOrphanedListeners.bind(this),a)}return s(e,[{key:"destroy",value:function(){clearInterval(this._orphanedListenerCheckTimer)}},{key:"receiveMessage",value:function(e){if(e.data&&"pubsub"==e.data.twitch_protocol&&e.source)switch(c.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"LISTEN":this.handleListen(e.source,e.data.nonce,e.data.data);break;case"UNLISTEN":this.handleUnlisten(e.source,e.data.nonce,e.data.data);break;case"connect":this._sources.push(e.source),this._driver.connect();break;case"verify":e.source.postMessage({twitch_protocol:"pubsub",type:"verify"},"*")}}},{key:"_pushListener",value:function(e,t){for(var n=0;n<this._listeners.length;n++)if(this._listeners[n].source===e&&this._listeners[n].topic===t)return null;var i={source:e,topic:t,message:function(n){e.postMessage({twitch_protocol:"pubsub",type:"message",topic:t,message:n},"*")}};return this._listeners.push(i),i}},{key:"_popListener",value:function(e,t){for(var n=0;n<this._listeners.length;n++)if(this._listeners[n].source===e&&this._listeners[n].topic===t)return this._listeners.splice(n,1)[0];return null}},{key:"_checkOrphanedListeners",value:function(){for(var e=0;e<this._listeners.length;e++)this._listeners[e].source.closed&&this._cleanUpOrphanedListener(this._listeners.splice(e--,1)[0])}},{key:"_cleanUpOrphanedListener",value:function(e){c.debug("Cleaning up orphaned listener for topic: "+e.topic),this._driver.Unlisten({topic:e.topic,success:function(){c.debug("Success when cleaning up orphaned listener for topic: "+e.topic)},failure:function(t){c.debug("Error when cleaning up orphaned listener for topic: "+e.topic+" Error: "+t)},message:e.message})}},{key:"handleListen",value:function(e,t,n){var i=this._pushListener(e,n.topics[0]);i?this._driver.Listen({topic:i.topic,auth:n.auth_token,success:function(){e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*")},failure:function(n){e.postMessage({twitch_protocol:"pubsub",type:"failure",nonce:t,error:n},"*")},message:i.message}):e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*")}},{key:"handleUnlisten",value:function(e,t,n){var i=this._popListener(e,n.topics[0]);i?this._driver.Unlisten({topic:i.topic,auth:n.auth_token,success:function(){e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*")},failure:function(n){e.postMessage({twitch_protocol:"pubsub",type:"failure",nonce:t,error:n},"*")},message:i.message}):c.debug("Failed to unlisten, could not find listener for topic "+n.topics[0])}},{key:"handleConnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:"pubsub",type:"connected"},"*")}},{key:"handleDisconnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:"pubsub",type:"disconnected"},"*")}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=u(n(4)),r=u(n(2)),o=u(n(3)),a=u(n(30)),c=u(n(10));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=r.default._getLogger("WebsocketClient"),d="wss://pubsub-edge.twitch.tv:443/v1",f="wss://pubsub-edge-darklaunch.twitch.tv:443/v1",p="ws://localhost:6900/v1",_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));switch(n._opts=e,n._env=e.env,n._stats=e.stats,n._env){case"production":n._addr=d;break;case"darklaunch":n._addr=f;break;case"development":n._addr=p;break;default:n._addr=d}return window.WebSocket?(n._queuedRequests=[],n._pendingResponses=new c.default,n._pendingReplayResponses=new c.default,n._listens=new s.default,n._replays=new c.default,n._replaysSize=0,n._firstConnectTime=n._firstListenTime=0,n._connectCalled=n._reconnecting=!1,n._primarySocket=new a.default({stats:n._stats,addr:n._addr}),n._bindPrimary(n._primarySocket),n):l(n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"verify",value:function(){this._trigger("verified")}},{key:"connect",value:function(){window.WebSocket&&(this._connectCalled?this._primarySocket._isReady()&&this._trigger("connected"):(this._connectCalled=!0,this._primarySocket.connect()))}},{key:"_bindPrimary",value:function(e){e.on("open",this._onPrimaryOpen,this),e.on("response",this._onResponse,this),e.on("message",this._onMessage,this),e.on("reconnect",this._onReconnect,this),e.on("connection_failure",this._onConnectionFailure,this)}},{key:"_unbindPrimary",value:function(e){e.off("open",this._onPrimaryOpen,this),e.off("response",this._onResponse,this),e.off("message",this._onMessage,this),e.off("reconnect",this._onReconnect,this),e.off("connection_failure",this._onConnectionFailure,this)}},{key:"_onPrimaryOpen",value:function(){h.debug("primary open: "+this._primarySocket._id),0===this._firstConnectTime&&(this._firstConnectTime=o.default.time.now(),this._firstListenTimeout=setTimeout(this._neverListened.bind(this),45e3)),this._connected=!0,this._trigger("connected"),this._flushQueuedRequests()}},{key:"_onResponse",value:function(e){if(h.debug("primary response: "+JSON.stringify(e)),this._pendingResponses.has(e.nonce)){var t=this._pendingResponses.get(e.nonce);h.debug("responseInfo: "+JSON.stringify(t)),clearTimeout(t.timeout),this._pendingResponses.remove(e.nonce),""===e.error?("LISTEN"===t.message.type?(0===this._firstListenTime&&(clearTimeout(this._firstListenTimeout),this._firstListenTime=o.default.time.now(),this._stats.logTimer("time_to_first_listen",this._firstListenTime-this._firstConnectTime,.1)),this._replays.set(e.nonce,{nonce:e.nonce,message:t.callbacks.message,topic:t.topic,auth:t.auth}),t.callbacks.message&&this._listens.on(t.topic,t.callbacks.message,this)):"UNLISTEN"===t.message.type&&(this._replays.remove(e.nonce),t.callbacks.message&&this._listens.off(t.topic,t.callbacks.message,this)),t.callbacks.success&&t.callbacks.success()):t.callbacks.failure&&t.callbacks.failure(e.error)}}},{key:"_onResponseTimeout",value:function(e){if(this._pendingResponses.has(e)){var t=this._pendingResponses.get(e);this._pendingResponses.remove(e),t.callbacks.failure&&t.callbacks.failure("response timeout")}}},{key:"_onMessage",value:function(e){h.debug("primary message: "+JSON.stringify(e)),this._listens._trigger(e.data.topic,e.data.message)}},{key:"_onConnectionFailure",value:function(){h.debug("connection failure"),this._trigger("disconnected"),this._notifyWhenOpen=!0,this._onReconnect()}},{key:"_onReconnect",value:function(){h.debug("reconnecting..."),this._reconnecting=!0,this._backupSocket=new a.default({stats:this._stats,addr:this._addr}),this._bindBackup(this._backupSocket),setTimeout(this._backupSocket.connect.bind(this._backupSocket),this._jitteredReconnectDelay())}},{key:"_bindBackup",value:function(e){e.on("open",this._onBackupOpen,this),e.on("response",this._onBackupResponse,this)}},{key:"_unbindBackup",value:function(e){e.off("open",this._onBackupOpen,this),e.off("response",this._onBackupResponse,this)}},{key:"_onBackupOpen",value:function(){h.debug("Backup socket opened"),this._replays.size()>0?this._replayBackup():(this._swapSockets(),this._notifyWhenOpen&&(h.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected")))}},{key:"_replayBackup",value:function(){for(var e=this._replays.values(),t=0;t<e.length;t++){var n={type:"LISTEN",nonce:this._generateNonce(),data:{topics:[e[t].topic],auth_token:e[t].auth}};this._pendingReplayResponses.set(n.nonce,!0),this._backupSocket.send(n)}}},{key:"_onBackupResponse",value:function(e){this._pendingReplayResponses.has(e.nonce)&&""===e.error&&(this._pendingReplayResponses.remove(e.nonce),0===this._pendingReplayResponses.size()&&(this._swapSockets(),this._notifyWhenOpen&&(h.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected"))))}},{key:"_swapSockets",value:function(){h.debug("swapping primary "+this._primarySocket._id+" and backup "+this._backupSocket._id),this._unbindPrimary(this._primarySocket),this._unbindBackup(this._backupSocket),this._bindPrimary(this._backupSocket),this._primarySocket.close(),this._primarySocket=this._backupSocket,this._reconnecting=!1,this._flushQueuedRequests()}},{key:"Listen",value:function(e){if(window.WebSocket){h.debug("listening on "+e.topic);var t=this._generateNonce(),n={type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._queuedSend(t,n,e)}}},{key:"Unlisten",value:function(e){if(window.WebSocket){if(h.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1){for(var t in this._listens.off(e.topic,e.message),this._replays.map())if(this._replays.get(t).message===e.message){this._replays.remove(t);break}return e.success&&e.success(),void h.debug("now have "+this._listens.count(e.topic)+" listeners")}var n=this._generateNonce(),i={type:"UNLISTEN",nonce:n,data:{topics:[e.topic]}};this._queuedSend(n,i,e)}}},{key:"_queuedSend",value:function(e,t,n){this._reconnecting||!1===this._primarySocket._isReady()?(h.debug("queuing"),this._queuedRequests.push({nonce:e,msg:t,opts:n})):(h.debug("sending immediately"),this._send(e,t,n))}},{key:"_flushQueuedRequests",value:function(){for(h.debug("flushing "+this._queuedRequests.length+" listen/unlistens");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();this._send(e.nonce,e.msg,e.opts)}}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),3e4,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),this._primarySocket.send(t)}},{key:"_neverListened",value:function(){this._stats.logCounter("first_listen_timeout",1)}},{key:"_generateNonce",value:function(){return o.default.generateString(30)}},{key:"_jitteredReconnectDelay",value:function(){return o.default.randomInt(2e3)}}]),t}(s.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=a(n(4)),r=a(n(2)),o=a(n(3));function a(e){return e&&e.__esModule?e:{default:e}}var c=r.default._getLogger("PubsubSocket"),u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._opts=e,n._addr=e.addr,n._stats=e.stats,n._connectionAttempts=0,n._sentPing=n._receivedPong=!1,n._id="["+o.default.generateString(10)+"] ",window.addEventListener("beforeunload",n._beforeUnload.bind(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"connect",value:function(){c.debug(this._id+"connecting to "+this._addr),this._connecting=!0,this._socketConnectTime=o.default.time.now();try{this._socket=new WebSocket(this._addr),this._socket.onmessage=this._onMessage.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onopen=this._onOpen.bind(this)}catch(e){this._stats.logCounter("socket.error.security_err",1,1),this._trigger("connection_failure")}}},{key:"close",value:function(){c.debug(this._id+"closing"),this._closing=!0,this._clearTimeouts(),this._socket.close()}},{key:"send",value:function(e){c.debug(this._id+"sending "+JSON.stringify(e)),this._isReady()?this._socket.send(JSON.stringify(e)):this._trigger("error","not_ready")}},{key:"_isReady",value:function(){return c.debug(this._id+"_isReady called"),!!this._socket&&this._socket.readyState===WebSocket.OPEN}},{key:"_onMessage",value:function(e){c.debug(this._id+"received message: "+e.data);try{var t=JSON.parse(e.data);switch(t.type){case"RESPONSE":this._trigger("response",t);break;case"MESSAGE":this._trigger("message",t);break;case"PONG":this._receivedPong=!0;break;case"RECONNECT":this._trigger("reconnect")}}catch(e){this._stats.logLine("onMessage JSON Parse error: "+e)}}},{key:"_onError",value:function(e){c.debug(this._id+"error: "+JSON.stringify(e))}},{key:"_onClose",value:function(e){if(c.debug(this._id+"onClose triggered with code "+e.code+"(closing = "+this._closing+", connecting = "+this._connecting+")"),this._clearTimeouts(),this._connecting){var t=Math.pow(2,this._connectionAttempts);t>120&&(t=120),c.debug(this._id+"reconnecting in "+t+" seconds"),this._connectionAttempts+=1,this._nextConnectionAttempt=setTimeout(this.connect.bind(this),1e3*t)}else if(this._closing)this._closed=!0,this._trigger("connection_failure");else{if(this._windowUnloading)return;c.debug(this._id+"unexpected close"),this._stats.logCounter("socket.error.unexpected_closed",1,1),this._stats.logCounter("socket.error.close."+e.code,1,1);var n="pubsub-js-client unexpected_close. code: "+e.code+", reason: "+e.reason+", wasClean: "+e.wasClean;this._stats.logLine(n),this._closed=!0,this._trigger("connection_failure")}}},{key:"_onOpen",value:function(e){c.debug(this._id+" socket opened"),this._connectionAttempts=0,this._connecting=!1,this._socketConnectTime&&this._stats.logTimer("socket.connect",o.default.time.now()-this._socketConnectTime,.1),this._stats.logCounter("socket.connection_retries."+this._connectionAttempts,1,.1),this._ping(),this._pingInterval=window.setInterval(this._ping.bind(this),24e4),this._trigger("open")}},{key:"_ping",value:function(){c.debug(this._id+"sending PING");try{this._socket.send(JSON.stringify({type:"PING"})),this._sentPing=!0,this._pongTimeout&&clearTimeout(this._pongTimeout),this._pongTimeout=setTimeout(this._pongTimedOut.bind(this),3e4)}catch(e){this._stats.logCounter("socket.error.ping_send_error",1,1),this._stats.logLine("ping error: closed: "+this._closed+", error: "+e),this.close()}}},{key:"_pongTimedOut",value:function(){this._sentPing&&!this._receivedPong&&(c.debug(this._id+"Pong timed out!"),this._stats.logCounter("socket.error.pong_timed_out",1,1),this.close())}},{key:"_clearTimeouts",value:function(){this._sentPing=this._receivedPong=!1,clearTimeout(this._pongTimeout),clearInterval(this._pingInterval),clearTimeout(this._nextConnectionAttempt)}},{key:"_beforeUnload",value:function(){this._windowUnloading=!0}}]),t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=o(n(3)),r=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var a="https://pubster.twitch.tv/publish",c="https://pubster-darklaunch.twitch.tv/publish",u="pubsubtest.unique.",l="pubsubtest.shared."+s.default.randomInt(10),h=r.default._getLogger("PubsubTest"),d=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.$){switch(h.debug("PubsubTest enabled"),this._env=t.env,this._driver=t.driver,this._stats=t.stats,this._env){case"production":this._addr=a;break;case"darklaunch":this._addr=c;break;default:this._env="production",this._addr=a}this._statKeys={uniqueSuccess:"test.unique.success",uniqueFailure:"test.unique.failure",sharedSuccess:"test.shared.success",sharedFailure:"test.shared.failure"},this._uniqueKey=u+s.default.generateString(20),this._sharedKey=l,this._listeningUnique=this._listeningShared=!1,this.sendListens()}else h.debug("PubsubTest could not be enabled. JQuery is undefined.")}return i(e,[{key:"sendListens",value:function(){this._driver.Listen({topic:this._uniqueKey,auth:"",success:this._gotUniqueOk.bind(this),failure:this._gotUniqueFail.bind(this),message:this._gotUniqueMessage.bind(this)}),this._driver.Listen({topic:this._sharedKey,auth:"",success:this._gotSharedOk.bind(this),failure:this._gotSharedFail.bind(this),message:this._gotSharedMessage.bind(this)})}},{key:"_gotUniqueOk",value:function(){this._listeningUnique=!0,this._listeningShared&&this.startTesting()}},{key:"_gotUniqueFail",value:function(e){}},{key:"_gotSharedOk",value:function(){this._listeningShared=!0,this._listeningUnique&&this.startTesting()}},{key:"_gotSharedFail",value:function(e){}},{key:"startTesting",value:function(){h.debug("startTesting"),this._driver.on("connected",this.resumeTesting,this),this._driver.on("disconnected",this.stopTesting,this),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),6e4)}},{key:"resumeTesting",value:function(){h.debug("resumeTesting"),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),6e4)}},{key:"stopTesting",value:function(){h.debug("stopTesting"),clearInterval(this._publishInterval),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1}},{key:"checkAndSend",value:function(){h.debug("checkAndSend: unique: sent = "+this._sentUniqueMessage+", received = "+this._receivedUniqueMessage),!this._receivedUniqueMessage&&this._sentUniqueMessage&&(h.debug("unique failure"),this._stats.logCounter(this._statKeys.uniqueFailure,1,1)),!this._receivedSharedMessage&&this._sentSharedMessage&&(h.debug("shared failure"),this._stats.logCounter(this._statKeys.sharedFailure,1,1)),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1,this._expectedMessage=s.default.generateString(30),$.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:3e4,data:JSON.stringify({topics:[this._uniqueKey],data:this._expectedMessage}),success:function(){h.debug("unique message sent"),this._sentUniqueMessage=!0}.bind(this)}),this._sentUniqueMessageTime=s.default.time.now(),Math.random()<1e-4&&($.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:3e4,data:JSON.stringify({topics:[this._sharedKey],data:this._expectedMessage}),success:function(){h.debug("shared message sent"),this._sentSharedMessage=!0}.bind(this)}),this._sentSharedMessageTime=s.default.time.now())}},{key:"_gotUniqueMessage",value:function(e){if(h.debug("received unique message: "+e),e===this._expectedMessage){var t=s.default.time.now()-this._sentUniqueMessageTime;this._receivedUniqueMessage=!0,this._stats.logTimer(this._statKeys.uniqueSuccess,t,.1),this._stats.logCounter(this._statKeys.uniqueSuccess,1,.1)}}},{key:"_gotSharedMessage",value:function(e){if(e===this._expectedMessage){var t=s.default.time.now()-this._sentSharedMessageTime;this._receivedSharedMessage=!0,this._stats.logTimer(this._statKeys.sharedSuccess,t,.1),this._stats.logCounter(this._statKeys.sharedSuccess,1,.1)}}}]),e}();t.default=d},function(e,t,n){"use strict";n.r(t);var i,s=n(5),r=n(0);!function(e){e.Production="production",e.Staging="staging",e.Test="test"}(i||(i={}));var o,a,c,u,l=function(){},h=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment=i.Production,t.pubsubEnvironment="production",t.pubsubURL="https://api.twitch.tv/v5/extensions/message",t.twitchAPIURL="https://api.twitch.tv",t}return h(t,e),t}(l),f=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment=i.Staging,t.pubsubEnvironment="darklaunch",t.pubsubURL="http://pubsub-broker-darklaunch.internal.twitch.tv",t.twitchAPIURL="https://api.twitch.tv",t}return f(t,e),t}(l),_=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment=i.Test,t.pubsubEnvironment="test",t.pubsubURL="http://test",t.twitchAPIURL="http://test",t}return _(t,e),t}(l),v=((a={})[i.Production]=d,a[i.Staging]=p,a[i.Test]=g,a),b=n(1),y=n(6),m=function(){function e(){var e=this;this.callbacks={},this.onControllerMessage=function(t){switch(t.action){case r.FunctionAction.FollowComplete:var n=e.callbacks[r.FunctionAction.FollowComplete];n&&n(t.didFollow,t.channel);break;case r.FunctionAction.SubscribeToChannelResult:var i=e.callbacks[r.FunctionAction.SubscribeToChannelResult];i&&i({didSubscribe:t.payload.didSubscribe,errorCode:t.payload.errorCode})}},this.followChannel=function(e){H({action:r.FunctionAction.FollowAction,payload:{channel:e}})},this.minimize=function(){H({action:r.FunctionAction.TwitchExtMinimize})},this.requestIdShare=function(){H({action:r.FunctionAction.IdShareRequest})},this.subscribeToChannel=function(e){H({action:r.FunctionAction.SubscribeToChannel,payload:e})},this.onFollow=function(t){e.callbacks[r.FunctionAction.FollowComplete]=t},this.onSubscribe=function(t){e.callbacks[r.FunctionAction.SubscribeToChannelResult]=t}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{followChannel:this.followChannel,onFollow:this.onFollow,minimize:this.minimize,requestIdShare:this.requestIdShare,subscribeToChannel:this.subscribeToChannel,onSubscribe:this.onSubscribe}},enumerable:!0,configurable:!0}),e}(),w=n(11),E=function(){function e(){var e=this;this.authData=null,this.useLoopback=!1,this.onControllerMessage=function(t){switch(t.action){case r.ExtensionAction.TwitchExtBitsTransactionComplete:e.onTransactionCompleteCallback&&e.onTransactionCompleteCallback({product:t.product,transactionId:t.transactionId,userId:t.userId,displayName:t.displayName,initiator:t.initiator,transactionReceipt:t.transactionReceipt});break;case r.ExtensionAction.TwitchExtBitsProducts:e.setProducts(t.products);break;case r.FunctionAction.UseBitsComplete:(!t.didConfirm||!t.didUseBits)&&e.onTransactionCancelledCallback&&e.onTransactionCancelledCallback()}},this.showBitsBalance=function(){window.parent.postMessage({action:r.ExtensionAction.TwitchExtBitsOnHover},"*")},this.useBits=function(t){e.useLoopback?e.loopbackUseBits(t):window.parent.postMessage({action:r.ExtensionAction.TwitchExtUseBits,sku:t},"*")},this.onTransactionComplete=function(t){e.onTransactionCompleteCallback=t},this.onTransactionCancelled=function(t){e.onTransactionCancelledCallback=t},this.getProducts=function(){return e.bitsProducts},this.setUseLoopback=function(t){e.useLoopback=t},this.loopbackUseBits=function(t){var n=e.authData?e.authData.userId:"0",i={transactionId:n+"."+(new Date).valueOf(),product:{sku:t,displayName:"test SKU",cost:{amount:"1",type:"bits"}},userId:n,displayName:"bits user",initiator:w.Initiator.CurrentUser};window.setTimeout((function(){e.onTransactionCompleteCallback&&e.onTransactionCompleteCallback(i)}),1e3)},this.setupBitsProducts()}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{getProducts:this.getProducts,useBits:this.useBits,onTransactionComplete:this.onTransactionComplete,onTransactionCancelled:this.onTransactionCancelled,showBitsBalance:this.showBitsBalance,setUseLoopback:this.setUseLoopback}},enumerable:!0,configurable:!0}),e.prototype.setAuth=function(e){this.authData=e},e.prototype.setupBitsProducts=function(){var e=this;this.bitsProducts=new Promise((function(t){e.setProducts=t}))},e}(),k=n(12),T=function(){function e(){var e=this;this.callbackMap=new Map,this.uuidV4=function(){return Object(k.v4)()},this.getConditionParticipants=function(t,n,i){var s=e.uuidV4();e.callbackMap.set(s,i),H({action:r.FunctionAction.ConditionParticipantsRequest,payload:{participantId:t,participantsAfter:n,callbackGuid:s}})},this.createConditionParticipant=function(t,n,i,s,o){var a=e.uuidV4();e.callbackMap.set(a,o),H({action:r.FunctionAction.ConditionConfirmationRequest,payload:{request:{conditionId:t,conditionOwnerId:n,bitsAmount:i,ttlSeconds:s,callbackGuid:a}}})},this.getConditions=function(t,n){var i=e.uuidV4();e.callbackMap.set(i,n),H({action:r.FunctionAction.ConditionsRequest,payload:{callbackGuid:i,conditionsAfter:t}})},this.createCondition=function(t,n,i){var s=e.uuidV4();e.callbackMap.set(s,i),H({action:r.FunctionAction.CreateConditionRequest,payload:{callbackGuid:s,name:t,disableWhenSatisfied:n}})}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{getConditionParticipants:this.getConditionParticipants,createConditionParticipant:this.createConditionParticipant,getConditions:this.getConditions,createCondition:this.createCondition}},enumerable:!0,configurable:!0}),e.prototype.onControllerMessage=function(e){switch(e.action){case r.FunctionAction.ConditionParticipantsResponse:case r.FunctionAction.ConditionsResponse:case r.FunctionAction.CreateConditionResponse:case r.FunctionAction.ConditionConfirmationResponse:this.executeCallback(e)}},e.prototype.executeCallback=function(e){var t=e.payload.callbackGuid;if(t){var n=this.callbackMap.get(t);n&&(n(e.payload.response,e.payload.error),this.callbackMap.delete(t))}},e}();!function(e){e.Broadcaster="broadcaster",e.Developer="developer",e.Global="global"}(c||(c={})),function(e){e.ConfigurationReceived="configuration-received"}(u||(u={}));var x,S=function(){function e(e){var t=this;this.callbackEvents=e,this.authData=null,this.eventEmitter=new b.EventEmitter2,this.addConfigurationChangeListener=function(e){t.eventEmitter.on(u.ConfigurationReceived,e)},this.setConfiguration=function(e,n,i){if(t.authData){var s=new XMLHttpRequest;s.open("PUT",V.twitchAPIURL+"/v5/extensions/"+t.authData.clientId+"/configurations/",!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Client-ID",t.authData.clientId),s.setRequestHeader("X-Requested-With","helper"),s.setRequestHeader("Authorization","Bearer "+t.authData.token),s.addEventListener("load",t.handleSetLoad),s.addEventListener("error",t.handleSetError),s.send(JSON.stringify({channel_id:t.authData.channelId,segment:e,version:n,content:i}))}else t.callbackEvents.emit(z.Error,new Error("Twitch.ext.configuration.set attempted before onAuthorized returned"))},this.handleSetLoad=function(e){var n=e.target;200!==n.status&&204!==n.status&&t.callbackEvents.emit(z.Error,new Error("Twitch.ext.configuration.set failed: "+n.statusText))},this.handleSetError=function(e){var n=e.message||"Network error";t.callbackEvents.emit(z.Error,new Error(n||"Twitch.ext.configuration.set failed"))}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get onChanged(){return e.addConfigurationChangeListener},get set(){return e.setConfiguration},get broadcaster(){return e.broadcaster},get developer(){return e.developer},get global(){return e.global}}},enumerable:!0,configurable:!0}),e.prototype.initializeConfiguration=function(e){void 0===e&&(e={}),this.broadcaster=e.broadcaster,this.developer=e.developer,this.global=e.global,this.eventEmitter.emit(u.ConfigurationReceived)},e.prototype.setAuth=function(e){this.authData=e},e}(),P=function(){return(P=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},C=["isChatEnabled","isBitsEnabled","isSubscriptionStatusAvailable"];!function(e){e.ExternalChanged="external-feature-changed"}(x||(x={}));var A=function(){function e(){var e=this;this.eventEmitter=new b.EventEmitter2,this.featureFlags={isChatEnabled:!1,isBitsEnabled:!1,isSubscriptionStatusAvailable:!1,useSharedPubsub:!1,bits:!1,sharePubsub:!1},this.addFeatureChangeListener=function(t){e.eventEmitter.on(x.ExternalChanged,t)},this.updateFeatureFlags=function(t){var n=Object.keys(t).filter((function(n){return-1!==C.indexOf(n)&&t[n]!==e.featureFlags[n]}));e.featureFlags=P({},e.featureFlags,t),n.length&&e.eventEmitter.emit(x.ExternalChanged,n)}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get isChatEnabled(){return e.featureFlags.isChatEnabled},get isBitsEnabled(){return e.featureFlags.isBitsEnabled},get isSubscriptionStatusAvailable(){return e.featureFlags.isSubscriptionStatusAvailable},get onChanged(){return e.addFeatureChangeListener}}},enumerable:!0,configurable:!0}),e.prototype.initializeFeatureFlags=function(e){this.updateFeatureFlags(e)},e.prototype.getFeatureFlag=function(e){return this.featureFlags[e]},e}(),O=n(13),L=n.n(O);function R(e){return-1===e.indexOf(".")}function M(){}var I,j=function(){function e(e,t){var n=this;this.features=e,this.callbackEvents=t,this.authData=null,this.listenQueue=[],this.sendQueue=[],this.targetListeners=new b.EventEmitter2,this.send=function(e,t,i){var s={target:e,contentType:t,message:i};n.authData?n.sendToPubsub(s):n.sendQueue.push(s)},this.listen=function(e,t){var i=n.targetListeners.listeners(e),s=0!==i.length;-1===i.indexOf(t)&&n.targetListeners.addListener(e,t),n.authData?s||n.listenToPubsub(e).catch((function(){n.targetListeners.removeListener(e,t)})):n.listenQueue.push(e)},this.unlisten=function(e,t){n.targetListeners.removeListener(e,t),n.targetListeners.listeners(e).length||n.unlistenFromPubsub(e)},this.handleSendLoad=function(e){var t=e.target;200!==t.status&&204!==t.status&&n.callbackEvents.emit(z.Error,new Error("sendToPubsub(signal) failed: "+t.statusText))},this.handleSendError=function(e){var t=e.message||"Network error";n.callbackEvents.emit(z.Error,new Error(t||"sendToPubsub(signal) failed"))}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get send(){return e.send},get listen(){return e.listen},get unlisten(){return e.unlisten}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return this.driverInstance||(this.driverInstance=L.a.getInstance(V.pubsubEnvironment),this.mockStatsBackend()),this.driverInstance},enumerable:!0,configurable:!0}),e.prototype.setAuth=function(e){var t=this;this.authData=e,this.sendQueue.length&&(this.sendQueue.forEach((function(e){return t.sendToPubsub(e)})),this.sendQueue=[]),this.listenQueue.length&&this.listenQueue.forEach((function(e){return t.listenToPubsub(e)}))},e.prototype.onControllerMessage=function(e){switch(e.action){case r.ExtensionAction.TwitchExtPubsubMessage:this.handleSharedPubsubMessage(e);break;case r.ExtensionAction.TwitchExtPubsubBindFailure:this.handleSharedPubsubFailure(e)}},e.prototype.sendToPubsub=function(e){if(this.authData){var t=new XMLHttpRequest;t.open("POST",this.getSendRequestURL(),!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Client-ID",this.authData.clientId),t.setRequestHeader("Authorization","Bearer "+this.authData.token),t.addEventListener("load",this.handleSendLoad),t.addEventListener("error",this.handleSendError),t.send(this.getSendRequestBody(e))}else this.callbackEvents.emit(z.Error,new Error("Twitch.ext.send attempted before onAuthorized returned"))},e.prototype.getSendRequestURL=function(){if(!this.authData)return"";switch(V.environment){case i.Production:return V.twitchAPIURL+"/v5/extensions/message/"+this.authData.channelId;case i.Staging:return V.pubsubURL+"/v1/message";case i.Test:return""+V.pubsubURL}return""},e.prototype.getSendRequestBody=function(e){if(!this.authData)return"";var t=e.contentType,n=e.message;switch(e.message instanceof Object&&(n=JSON.stringify(e.message),t="application/json"),V.environment){case i.Production:return JSON.stringify({auth:this.authData.token,content_type:t,message:n,targets:[e.target]});case i.Staging:return JSON.stringify({topics:["channel-ext-v1."+this.authData.channelId+"-"+this.authData.clientId+"-"+e.target],data:JSON.stringify({content_type:e.contentType,content:[e.message],num_messages:1,request_numbers:[]})});case i.Test:return"test"}return""},e.prototype.getUseSharedPubsub=function(){return this.features.getFeatureFlag("sharePubsub")||this.features.getFeatureFlag("useSharedPubsub")},e.prototype.handleSharedPubsubMessage=function(e){var t=this,n=e.payload,i=n.target,s=n.contentType;n.content.forEach((function(e){t.targetListeners.emit(i,i,s,e)}))},e.prototype.handleSharedPubsubFailure=function(e){this.callbackEvents.emit(z.Error,new Error(e.payload.error))},e.prototype.listenToPubsub=function(e){var t=this;return new Promise((function(n,i){return t.getUseSharedPubsub()?(H({action:r.ExtensionAction.TwitchExtPubsubListen,target:e}),n()):t.authData?void t.driver.Listen({auth:t.authData.token,topic:t.targetToTopic(e),failure:i,success:n,message:function(n){var i;R(e)||t.targetListeners.emit(e,e,"application/plain",n);try{i=JSON.parse(n)}catch(e){return void t.callbackEvents.emit(z.Error,new Error("ill-formed JSON response received"))}i.content.forEach((function(n){t.targetListeners.emit(e,e,i.content_type,n)})),i.sequence&&H({action:r.ExtensionAction.TwitchExtPubSubReceived,payload:{target:e,topic:t.targetToTopic(e),sequenceNumber:i.sequence.number,sequenceStart:i.sequence.start}})}}):i()}))},e.prototype.unlistenFromPubsub=function(e){var t=this;return new Promise((function(n,i){if(t.getUseSharedPubsub())return H({action:r.ExtensionAction.TwitchExtPubsubUnlisten,target:e}),n();t.driver.Unlisten({topic:t.targetToTopic(e),failure:i,success:n,message:M})}))},e.prototype.targetToTopic=function(e){if(!this.authData)return"";if(R(e)){var t=this.authData.channelId;return"global"===e&&(t="all"),"channel-ext-v1."+t+"-"+this.authData.clientId+"-"+e}return e},e.prototype.mockStatsBackend=function(){this.driverInstance&&(this.driverInstance._stats._backend={logCounter:M,logGauge:M,logLine:M,logTimer:M,setPrefix:M})},e}();!function(e){e.Reload="purchases-event-reload-entitlements"}(I||(I={}));var U,q=function(){function e(){var e=this;this.eventEmitter=new b.EventEmitter2,this.beginPurchase=function(e){H({action:r.ExtensionAction.TwitchExtBeginPurchase,payload:{sku:e}})},this.onReloadEntitlements=function(t){e.eventEmitter.removeAllListeners(I.Reload),e.eventEmitter.addListener(I.Reload,t)},this.getPrices=function(){return e.prices},this.setupProducts()}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{beginPurchase:this.beginPurchase,getPrices:this.getPrices,onReloadEntitlements:this.onReloadEntitlements}},enumerable:!0,configurable:!0}),e.prototype.onControllerMessage=function(e){switch(e.action){case r.ExtensionAction.TwitchExtProductPrices:this.setPrices(e.prices);break;case r.ExtensionAction.TwitchExtReloadEntitlements:this.eventEmitter.emit(I.Reload)}},e.prototype.setupProducts=function(){var e=this;this.prices=new Promise((function(t){e.setPrices=t}))},e}();!function(e){e.Log="twitch-ext-rig-log"}(U||(U={}));var F,N=function(){function e(){}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{log:this.log}},enumerable:!0,configurable:!0}),e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];window.parent.postMessage({action:U.Log,messages:[e].concat(t)},"*")},e}(),B=function(){function e(){var e=this;this.uniqueEventNames=[],this.trackEvent=function(t,n,i,s){t.length>r.MAX_DEV_EVENT_FIELD_LENGTH?console.error("You have specified an event name over the "+r.MAX_DEV_EVENT_FIELD_LENGTH+" character limit. Please choose a shorter name"):(e.uniqueEventNames.includes(t)||e.uniqueEventNames.push(t),e.uniqueEventNames.length>r.MAX_UNIQUE_DEV_EVENT_NAMES?console.error("You have used more than "+r.MAX_UNIQUE_DEV_EVENT_NAMES+" unique event names. You cannot track any more types of events"):s&&s.length>r.MAX_CUSTOM_METADATA_LENGTH?console.error("Your custom metadata string exceeds the maximum allowed length of "+r.MAX_CUSTOM_METADATA_LENGTH+" characters"):H({action:r.ExtensionAction.TwitchExtCustomTrackEvent,payload:{developerName:t,interactionType:n,category:i,customMetadata:s}}))}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{trackEvent:this.trackEvent,Categories:r.CustomEventCategory,InteractionTypes:r.CustomEventInteractionType}},enumerable:!0,configurable:!0}),e}(),D=function(){return(D=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};!function(e){e.ViewerStatusUpdated="viewer-status-updated"}(F||(F={}));var V,H,z,G=function(){function e(){var e=this;this.eventEmitter=new b.EventEmitter2,this.viewerStatus=null,this.updateInternalStatus=function(t){if(e.viewerStatus){var n=Object.keys(t).filter((function(n){return!!(e.viewerStatus&&n in e.viewerStatus)&&t[n]!==e.viewerStatus[n]}));e.viewerStatus=D({},e.viewerStatus,t),n.length&&e.eventEmitter.emit(F.ViewerStatusUpdated)}},this.addViewerChangeListener=function(t){e.eventEmitter.on(F.ViewerStatusUpdated,t)}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get onChanged(){return e.addViewerChangeListener},get id(){return e.viewerStatus&&e.viewerStatus.id},get opaqueId(){return e.viewerStatus&&e.viewerStatus.opaqueId},get role(){return e.viewerStatus&&e.viewerStatus.role},get isLinked(){return e.viewerStatus&&e.viewerStatus.isLinked},get sessionToken(){return e.viewerStatus&&e.viewerStatus.sessionToken},get subscriptionStatus(){return e.viewerStatus&&e.viewerStatus.subscriptionStatus}}},enumerable:!0,configurable:!0}),e.prototype.initializeViewer=function(e,t){var n,i=e.token.split(".")[1];if(i){try{n=JSON.parse(atob(i))}catch(e){return}this.viewerStatus={id:n.user_id||null,opaqueId:n.opaque_user_id,role:n.role,isLinked:void 0!==n.user_id,sessionToken:e.token,subscriptionStatus:t?t.subscriptionStatus:null},this.eventEmitter.emit(F.ViewerStatusUpdated)}},e.prototype.updateViewerInfo=function(e){if(this.viewerStatus){var t=D({},this.viewerStatus,e);this.updateInternalStatus(t)}},e.prototype.setAuth=function(e){if(this.viewerStatus){var t,n=e.token.split(".")[1];if(n){try{t=JSON.parse(atob(n))}catch(e){return}var i=D({},this.viewerStatus,{id:t.user_id||null,opaqueId:t.opaque_user_id,role:t.role,isLinked:void 0!==t.user_id,sessionToken:e.token});this.updateInternalStatus(i)}}},e}(),W=function(){return(W=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object(s.polyfill)(),function(e){e.Authorized="callback-event-authorized",e.Context="callback-event-context",e.Error="callback-event-error",e.Position="callback-event-position",e.ReloadEntitlements="callback-event-reload-entitlements",e.Visibility="callback-event-visibility",e.Highlight="callback-event-highlight"}(z||(z={}));var J=function(){function e(e,t){var n=this;this.packageVersion=t,this.authData=null,this.context=null,this.contextChangedFields=[],this.isVisible=!0,this.handleMessageEvent=function(e){if(e.source===window.parent){var t=e.data;switch(t.action){case r.ExtensionAction.TwitchExtBootstrap:n.features.initializeFeatureFlags(t.features),n.configuration.initializeConfiguration(t.configuration),n.viewer.initializeViewer(t.auth,t.viewerInfo),n.onAuthReceived(t.auth);break;case r.ExtensionAction.TwitchExtReload:window.location.reload();break;case r.ExtensionAction.TwitchExtAuth:n.onAuthReceived(t.auth);break;case r.ExtensionAction.TwitchExtError:n.callbackEvents.emit(z.Error,new Error(t.message));break;case r.ExtensionAction.TwitchExtContext:n.context=t.context,n.contextChangedFields=t.updatedFields,n.callbackEvents.emit(z.Context,n.context,n.contextChangedFields);break;case r.ExtensionAction.TwitchExtVisibilityChanged:n.isVisible=t.isVisible,n.callbackEvents.emit(z.Visibility,t.isVisible,t.context);break;case r.ExtensionAction.TwitchExtPositionChanged:n.callbackEvents.emit(z.Position,t.position);break;case r.ExtensionAction.TwitchExtHighlightChanged:n.callbackEvents.emit(z.Highlight,t.isHighlighted);break;case r.ExtensionAction.TwitchExtViewerUpdate:n.viewer.updateViewerInfo(t.viewerInfo)}n.actions.onControllerMessage(t),n.bits.onControllerMessage(t),n.purchases.onControllerMessage(t),n.pubsub.onControllerMessage(t),n.conditions.onControllerMessage(t)}},this.onAuthorized=function(e){n.callbackEvents.removeAllListeners(z.Authorized),n.callbackEvents.addListener(z.Authorized,e),n.authData&&n.callbackEvents.emit(z.Authorized,n.authData)},this.onError=function(e){n.callbackEvents.removeAllListeners(z.Error),n.callbackEvents.addListener(z.Error,e)},this.onContext=function(e){n.callbackEvents.removeAllListeners(z.Context),n.callbackEvents.addListener(z.Context,e),n.authData&&n.callbackEvents.emit(z.Context,n.context,n.contextChangedFields)},this.onPositionChanged=function(e){n.callbackEvents.removeAllListeners(z.Position),n.callbackEvents.addListener(z.Position,e)},this.onVisibilityChanged=function(e){n.callbackEvents.removeAllListeners(z.Visibility),n.callbackEvents.addListener(z.Visibility,e),n.isVisible||n.callbackEvents.emit(z.Visibility,n.isVisible,null)},this.onHighlightChanged=function(e){n.callbackEvents.removeAllListeners(z.Highlight),n.callbackEvents.addListener(z.Highlight,e)},this.onNetworkResourceTiming=function(){},V=this.config=e,H=this.sendCoordinatorMessage,this.features=new A,this.callbackEvents=new b.EventEmitter2,this.pubsub=new j(this.features,this.callbackEvents),this.actions=new m,this.bits=new E,this.configuration=new S(this.callbackEvents),this.purchases=new q,this.rig=new N,this.viewer=new G,this.conditions=new T,this.tracking=new B;var i=window.performance,s=window.location.href;Object(y.isSniffingAllowed)(i)&&(this.networkSniffer=new y.NetworkSniffer(i,s),this.networkSniffer.start(),this.networkSniffer.addResourceListener(this.onNetworkResourceTiming))}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return W({get version(){return e.packageVersion},get environment(){return e.config.environment},get onAuthorized(){return e.onAuthorized},get onContext(){return e.onContext},get onError(){return e.onError},get onPositionChange(){return e.onPositionChanged},get onPositionChanged(){return e.onPositionChanged},get onVisibilityChanged(){return e.onVisibilityChanged},get onHighlightChanged(){return e.onHighlightChanged}},this.pubsub.publicAPI,{get actions(){return e.actions.publicAPI},get bits(){return e.bits.publicAPI},get configuration(){return e.configuration.publicAPI},get features(){return e.features.publicAPI},get purchases(){return e.purchases.publicAPI},get rig(){return e.rig.publicAPI},get viewer(){return e.viewer.publicAPI},get conditions(){return e.conditions.publicAPI},get tracking(){return e.tracking.publicAPI}})},enumerable:!0,configurable:!0}),e.prototype.sendCoordinatorMessage=function(e){window.parent.postMessage(e,"*")},e.prototype.onAuthReceived=function(e){this.authData=e,this.pubsub.setAuth(e),this.viewer.setAuth(e),this.configuration.setAuth(e),this.callbackEvents.emit(z.Authorized,e)},e}(),X=["assert","clear","count","debug","dir","dirxml","exception","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];function Q(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var K=["click","mousemove"],$=function(){function e(e,t,n,i){var s=this;this.onDOMContentLoaded=function(){s.window.addEventListener("message",s.handleMessageEvent,!1),s.parentWindow.postMessage({action:r.ExtensionAction.TwitchExtLoaded},"*"),s.forceVideoOverlayFullSize()},this.bindLongtaskHandler=function(){window.PerformanceObserver&&window.PerformanceLongTaskTiming&&(s.performanceObserver=new window.PerformanceObserver((function(e){e.getEntries().forEach(s.trackLongtask)})),s.performanceObserver.observe({entryTypes:["longtask"]}))},this.unbindLongtaskHandler=function(){s.performanceObserver&&(s.performanceObserver.disconnect(),s.performanceObserver=void 0)},this.trackLongtask=function(e){s.shouldTrackLongtask(e)&&s.parentWindow.postMessage({action:r.ExtensionAction.TwitchExtLongtask,payload:{longtask_duration:e.duration}},"*")},this.onMouseAction=function(e){s.parentWindow.postMessage({action:r.ExtensionAction.TwitchExtUserAction,payload:{type:e.type,clientX:e.clientX,clientY:e.clientY}},"*"),s.forceVideoOverlayFullSize()},this.onFocus=function(e){switch(e.target.tagName.toLowerCase()){case"input":case"select":case"textarea":case"button":return;default:s.parentWindow.postMessage({action:r.ExtensionAction.TwitchExtUserAction,payload:{type:e.type}},"*")}},this.window=n||window,this.parentWindow=this.window.parent,this.documentObject=i||document,this.params=e,this.handleMessageEvent=t,this.isViewerVideoOverlay="video_overlay"===this.params.anchor&&this.params.mode===r.ExtensionMode.Viewer}return e.prototype.forceVideoOverlayFullSize=function(){var e;this.isViewerVideoOverlay&&([(e=this.documentObject).documentElement,e.body].forEach((function(e){e.style.setProperty("width","100%","important"),e.style.setProperty("height","100%","important")})),e.body.setAttribute("tabindex","-1"))},e.prototype.bindEvents=function(){var e=this;this.documentObject.addEventListener("DOMContentLoaded",this.onDOMContentLoaded),K.forEach((function(t){e.documentObject.addEventListener(t,e.onMouseAction,!0)})),this.documentObject.addEventListener("dblclick",this.onMouseAction),this.documentObject.addEventListener("focusin",this.onFocus,!0),this.bindLongtaskHandler()},e.prototype.unbindEvents=function(){var e=this;this.documentObject.removeEventListener("DOMContentLoaded",this.onDOMContentLoaded),K.forEach((function(t){e.documentObject.removeEventListener(t,e.onMouseAction,!0)})),this.documentObject.removeEventListener("dblclick",this.onMouseAction),this.documentObject.removeEventListener("focusin",this.onFocus,!0),this.unbindLongtaskHandler()},e.prototype.shouldTrackLongtask=function(e){var t=.1>Math.random(),n="self"===e.name;return t&&n},e}(),Y=new J(new v.production,"1.23.0"),Z={anchor:Q("anchor"),mode:Q("mode"),state:Q("state")},ee=Q("platform");ee&&(Z.platform=ee);var te,ne=new $(Z,Y.handleMessageEvent,window,document);ne.bindEvents(),Z.state===r.ExternalExtensionState.Released&&(window.console?te=Object.keys(window.console).filter((function(e){return"function"==typeof window.console[e]})):(window.console={},te=X),te.forEach((function(e){window.console[e]=function(){return 0}}))),document.body&&ne.forceVideoOverlayFullSize(),window.Twitch=window.Twitch||{},window.Twitch.ext=window.Twitch.ext||Y.publicAPI},function(e,t,n){"use strict";n.r(t);const i=500,s=20,r="__Twitch__statsInstances_1",o={production:{addr:"https://client-event-reporter.twitch.tv"},darklaunch:{addr:"https://client-event-reporter-darklaunch.twitch.tv"}};o.staging=o.darklaunch,o.development=o.darklaunch,o.test=o.darklaunch;class a{constructor(e){if(!e)throw new Error("config is required");this._addr=e.addr,this._resetCombinedStats(),this._recordDelay=i,this._maxPendingStats=s}logCounter(e,t=1,n=1){this._combinedStats.counters.push({key:e,count:t,sample_rate:n}),this._record()}logTimer(e,t,n=1){this._combinedStats.timers.push({key:e,milliseconds:t,sample_rate:n}),this._record()}logLine(e){this._combinedStats.log_lines.push({log_line:e}),this._record()}logGauge(e){this._combinedStats.gauges.push({key:e}),this._record()}_resetCombinedStats(){this._combinedStats={timers:[],counters:[],log_lines:[],gauges:[]}}_record(){this._numPendingStats()>this._maxPendingStats?(this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=null),this._flush()):this._flushTimeout||(this._flushTimeout=setTimeout(()=>{this._flushTimeout=null,this._flush()},this._recordDelay))}_flush(){let e=this._combinedStats;this._resetCombinedStats();let t=`${this._addr}/v1/stats`,n=this._createCorsRequest("POST",t);n?(n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))):console.log("WARNING: Cannot send stats because CORS is unsupported")}_numPendingStats(){let e=this._combinedStats;return e.timers.length+e.counters.length+e.log_lines.length+e.gauges.length}_createCorsRequest(e,t){let n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}}class c{constructor(e,t){if(!e)throw new Error("Missing backend");if(!t)throw new Error("Missing prefix");this._backend=e,this._prefix=t}logCounter(e,t=1,n=1){this._backend.logCounter(`${this._prefix}.${e}`,t,n)}logTimer(e,t,n=1){this._backend.logTimer(`${this._prefix}.${e}`,t,n)}logLine(e){this._backend.logLine(e)}logGauge(e){this._backend.logGauge(e)}setPrefix(e){if(!e)throw new Error("Missing prefix");this._prefix=e}}var u={getInstance:function(e,t){let n=o[e];if(!n)throw new Error("Invalid environment - got "+e);if(!t)throw new Error("Invalid prefix - got "+t);window[r]=window[r]||{};let i=window[r];i[e]||(i[e]=new a(n));let s=i[e];return new c(s,t)}};n.d(t,"Stats",(function(){return u}));t.default={Stats:u}}]);